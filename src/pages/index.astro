---
import GameCard from '../components/GameCard.astro';
import listaDeJogos from '../data/jogos.json';
import PerfilJogador from '../components/PerfilJogador.astro';
const categorias = [...new Set(listaDeJogos.map((jogo) => jogo.categoria))];
---

<html lang="pt">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/png" href="/logo.png" />
    <meta name="viewport" content="width=device-width" />
    <title>Gamer Portal</title>
  </head>
  <body>
    
    <div class="retro-bg"><div class="grid"></div></div>

    <header>
      <a href="/" class="logo-link">
        <div class="logo-text">GAMER <span class="highlight">PORTAL</span></div>
      </a>

	  <PerfilJogador />  <div class="search-container">
      
      <div class="search-container">
        <input type="text" id="searchBox" placeholder="Pesquisar jogos..." />
      </div>

      <div class="filters">
        <button class="filter-btn active" data-cat="todos">Todos</button>
        
        <button class="filter-btn fav-filter" data-cat="favoritos">
          ‚ù§Ô∏è Favoritos
        </button>

        {categorias.map((cat) => (
          <button class="filter-btn" data-cat={cat}>{cat}</button>
        ))}
      </div>
    </header>

    <main class="game-grid">
      {listaDeJogos.map((jogo) => (
        <div 
          class="game-wrapper" 
          data-titulo={jogo.titulo.toLowerCase()} 
          data-categoria={jogo.categoria}
          data-id={jogo.id}
        >
          <GameCard 
            id={jogo.id}
            titulo={jogo.titulo} 
            thumb={jogo.thumb} 
            categoria={jogo.categoria} 
          />
        </div>
      ))}
    </main>
    
    <p id="no-results" style="display: none; text-align: center; color: #aaa; margin-top: 20px; background: rgba(0,0,0,0.5); padding: 10px; border-radius: 10px;">
      Nenhum jogo encontrado... üò¢
    </p>

    <script>
      const searchBox = document.getElementById('searchBox');
      const filterBtns = document.querySelectorAll('.filter-btn');
      const games = document.querySelectorAll('.game-wrapper');
      const noResults = document.getElementById('no-results');
      
      // Lista de IDs favoritos (L√™ do LocalStorage ou come√ßa vazio)
      let favoritos = JSON.parse(localStorage.getItem('meusJogosFavoritos')) || [];

      // 1. FUN√á√ÉO PARA ATUALIZAR OS CORA√á√ïES NO ECR√É
      function atualizarCoracoes() {
        document.querySelectorAll('.heart-btn').forEach(btn => {
          const id = btn.getAttribute('data-id');
          if (favoritos.includes(id)) {
            btn.classList.add('liked'); // Pinta de rosa
          } else {
            btn.classList.remove('liked'); // Pinta de branco
          }
        });
      }

      // 2. L√ìGICA DE FILTRAGEM (Agora inclui favoritos)
      let categoriaAtual = 'todos';

      function filtrar() {
        const termo = searchBox.value.toLowerCase();
        let visiveis = 0;

        games.forEach((game) => {
          const titulo = game.getAttribute('data-titulo');
          const catJogo = game.getAttribute('data-categoria');
          const idJogo = game.getAttribute('data-id');

          const matchTexto = titulo.includes(termo);
          let matchCat = false;

          // L√≥gica especial para o bot√£o "Favoritos"
          if (categoriaAtual === 'favoritos') {
            matchCat = favoritos.includes(idJogo);
          } else {
            matchCat = categoriaAtual === 'todos' || catJogo === categoriaAtual;
          }

          if (matchTexto && matchCat) {
            game.style.display = 'block';
            visiveis++;
          } else {
            game.style.display = 'none';
          }
        });

        noResults.style.display = visiveis > 0 ? 'none' : 'block';
        if (visiveis === 0 && categoriaAtual === 'favoritos') {
          noResults.textContent = "Ainda n√£o tens favoritos! Clica nos ‚ù§Ô∏è";
        } else {
          noResults.textContent = "Nenhum jogo encontrado... üò¢";
        }
      }

      // 3. DAR VIDA AOS BOT√ïES DE CORA√á√ÉO
      document.querySelectorAll('.heart-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const id = btn.getAttribute('data-id');
          
          if (favoritos.includes(id)) {
            // Se j√° gosta, remove da lista
            favoritos = favoritos.filter(favId => favId !== id);
          } else {
            // Se n√£o gosta, adiciona √† lista
            favoritos.push(id);
          }

          // Grava na mem√≥ria do navegador
          localStorage.setItem('meusJogosFavoritos', JSON.stringify(favoritos));
          
          atualizarCoracoes();
          
          // Se estivermos a ver a aba "Favoritos", atualiza a lista logo
          if (categoriaAtual === 'favoritos') filtrar(); 
        });
      });

      // Inicializa√ß√£o
      atualizarCoracoes();
      searchBox.addEventListener('input', filtrar);
      
      filterBtns.forEach((btn) => {
        btn.addEventListener('click', () => {
          filterBtns.forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          categoriaAtual = btn.getAttribute('data-cat');
          filtrar();
        });
      });
    </script>

	<div id="google_translate_element" style="position: fixed; bottom: 20px; right: 20px; z-index: 9999; background: #000; padding: 5px; border-radius: 8px; border: 1px solid #333;"></div>

<script type="text/javascript">
function googleTranslateElementInit() {
  new google.translate.TranslateElement({
    pageLanguage: 'pt', 
    layout: google.translate.TranslateElement.InlineLayout.SIMPLE,
    autoDisplay: false
  }, 'google_translate_element');
}
</script>

<script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

  </body>
</html>

<style>
  /* C√ìPIA DO CSS ANTIGO + NOVIDADES */
  body {
    background-color: #050505;
    font-family: system-ui, sans-serif;
    color: white;
    margin: 0;
    padding-bottom: 50px;
  }

  /* FUNDO RETRO ANIMADO */
  .retro-bg {
    position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
    background-color: #050505; z-index: -1; overflow: hidden; perspective: 1000px;
  }
  .grid {
    position: absolute; width: 300%; height: 200%; left: -100%; top: -50%;
    background-image: linear-gradient(rgba(255, 0, 85, 0.3) 1px, transparent 1px), linear-gradient(90deg, rgba(255, 0, 85, 0.3) 1px, transparent 1px);
    background-size: 40px 40px; transform: rotateX(45deg); animation: moverGrelha 20s linear infinite;
    mask-image: linear-gradient(to bottom, transparent 5%, black 40%);
    -webkit-mask-image: linear-gradient(to bottom, transparent 5%, black 40%);
  }
  @keyframes moverGrelha { 0% { background-position: 0 0; } 100% { background-position: 0 40px; } }

  header {
    text-align: center;
    padding: 40px 20px;
    background: linear-gradient(to bottom, #111, rgba(5,5,5,0));
    margin-bottom: 10px;
  }

  .logo-link { text-decoration: none; display: inline-block; margin-bottom: 25px; }
  .logo-text {
    font-size: 3.5rem; font-weight: 900; font-style: italic; text-transform: uppercase; letter-spacing: -3px; line-height: 1; color: white;
    text-shadow: 0 0 10px rgba(255, 0, 85, 0.3), 0 0 40px rgba(255, 0, 85, 0.3);
    transform: skew(-5deg); transition: transform 0.3s ease;
  }
  .highlight { color: #ff0055; }
  .logo-link:hover .logo-text { transform: skew(-5deg) scale(1.05); }

  .search-container input {
    width: 100%; max-width: 400px; padding: 12px 20px; border-radius: 30px;
    border: 2px solid #333; background-color: rgba(26, 26, 26, 0.8); color: white;
    margin-bottom: 20px; outline: none; transition: 0.3s; backdrop-filter: blur(5px);
  }
  .search-container input:focus { border-color: #ff0055; background-color: #222; }

  .filters { display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; }
  .filter-btn {
    background: rgba(34, 34, 34, 0.8); border: 1px solid #333; color: #aaa;
    padding: 8px 16px; border-radius: 20px; cursor: pointer; font-weight: bold;
    transition: all 0.3s ease; text-transform: capitalize;
  }
  .filter-btn:hover { background: #333; color: white; }
  .filter-btn.active { background: #ff0055; color: white; border-color: #ff0055; box-shadow: 0 0 15px rgba(255, 0, 85, 0.4); }
  
  /* ESTILO ESPECIAL PARA O BOT√ÉO FAVORITOS */
  .fav-filter { border-color: #ff0055; color: #ff0055; }
  .fav-filter:hover { background: #ff0055; color: white; }

  .game-grid {
    display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 2rem; padding: 0 2rem; max-width: 1200px; margin: 0 auto;
  }
  
  @media (max-width: 600px) { .logo-text { font-size: 2.5rem; } }

  /* --- BARRA DE SCROLL PERSONALIZADA --- */

/* A calha da barra (o fundo) */
::-webkit-scrollbar {
  width: 12px;
  background-color: #050505;
}

/* O "polegar" (a parte que mexes) */
::-webkit-scrollbar-thumb {
  background: #333; /* Cinzento escuro */
  border-radius: 6px;
  border: 2px solid #050505; /* Borda para parecer separado */
}

/* Quando passas o rato na barra */
::-webkit-scrollbar-thumb:hover {
  background: #ff0055; /* Fica ROSA N√âON! */
  box-shadow: 0 0 10px rgba(255, 0, 85, 0.5);
}

/* Para o Firefox (navegadores diferentes usam regras diferentes) */
html {
  scrollbar-width: thin;
  scrollbar-color: #333 #050505;
}

</style>